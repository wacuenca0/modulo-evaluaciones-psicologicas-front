<div *ngIf="atenciones.length === 0" class="p-4 text-center text-gray-500">
  No hay atenciones para mostrar.
</div>
<ul *ngIf="atenciones.length > 0" class="grid gap-4 grid-cols-1">
  <li *ngFor="let atencion of atenciones" class="atencion-card rounded-2xl shadow-md bg-white p-5 flex flex-row gap-5 border-l-8"
      [ngClass]="{
        'border-purple-300 bg-purple-50': atencion.tipoEvaluacion,
        'border-blue-200 bg-blue-50': !atencion.tipoEvaluacion && atencion.estado === 'PROGRAMADA',
        'border-yellow-200 bg-yellow-50': !atencion.tipoEvaluacion && atencion.estado === 'EN_CURSO',
        'border-green-200 bg-green-50': !atencion.tipoEvaluacion && atencion.estado === 'FINALIZADA',
        'border-red-200 bg-red-50': !atencion.tipoEvaluacion && atencion.estado === 'CANCELADA',
        'border-gray-200 bg-gray-50': !atencion.tipoEvaluacion && (atencion.estado === 'NO_ASISTIO' || atencion.estado === 'REPROGRAMADA'),
        'ring-2 ring-purple-500 ring-offset-2 shadow-lg': resaltarId === atencion.id
      }">
    <div class="flex-1 flex flex-col gap-2">
      <div class="flex items-center gap-2 mb-2">
        <span class="font-semibold text-lg md:text-xl text-slate-900 tracking-tight">{{ atencion.pacienteNombreCompleto }}</span>
        <span class="ml-auto inline-flex items-center gap-1.5 px-3 py-0.5 rounded-full text-[12px] font-semibold uppercase tracking-wide"
          [ngClass]="{
            'bg-blue-100 text-blue-800': atencion.estado === 'PROGRAMADA',
            'bg-yellow-100 text-yellow-800': atencion.estado === 'EN_CURSO',
            'bg-green-100 text-green-800': atencion.estado === 'FINALIZADA',
            'bg-red-100 text-red-800': atencion.estado === 'CANCELADA',
            'bg-gray-200 text-gray-700': atencion.estado === 'NO_ASISTIO' || atencion.estado === 'REPROGRAMADA'
          }">
          <span class="w-2 h-2 rounded-full bg-current opacity-80"></span>
          <span>{{ atencion.estado }}</span>
        </span>
      </div>

      <!-- Badge especial para seguimientos: solo si viene tipoEvaluacion -->
      <div *ngIf="atencion.tipoEvaluacion" class="mt-1 inline-flex items-center gap-2.5 px-3 py-1.5 rounded-full bg-purple-100 text-purple-800 text-[12px] font-semibold uppercase tracking-wide">
        <span class="w-2 h-2 rounded-full bg-purple-500"></span>
        <span>Seguimiento: {{ atencion.tipoEvaluacion }}</span>
      </div>

      <!-- Línea de datos clínicos principales -->
      <div class="mt-2 text-sm text-slate-700 flex flex-wrap gap-x-6 gap-y-1">
        <span class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z" />
          </svg>
          <span><b>Fecha:</b> {{ atencion.fechaAtencion }}</span>
        </span>
        <span class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 2m6-2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" />
          </svg>
          <span><b>Hora:</b> {{ atencion.horaInicio }} - {{ atencion.horaFin }}</span>
        </span>
        <span *ngIf="atencion.duracionMinutos" class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 2m6-2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" />
          </svg>
          <span><b>Duración:</b> {{ atencion.duracionMinutos }} min</span>
        </span>
      </div>

      <!-- Profesional y unidad -->
      <div class="mt-1 text-sm text-slate-700 flex flex-wrap gap-x-6 gap-y-1">
        <span class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM12 14a7 7 0 0 0-7 7h14a7 7 0 0 0-7-7z" />
          </svg>
          <span><b>Psicólogo:</b> {{ atencion.psicologoNombreCompleto }}</span>
        </span>
        <span *ngIf="atencion.pacienteGrado || atencion.pacienteUnidadMilitar" class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
          </svg>
          <span>
            <b>Unidad:</b>
            {{ atencion.pacienteGrado }}
            <span *ngIf="atencion.pacienteUnidadMilitar">• {{ atencion.pacienteUnidadMilitar }}</span>
          </span>
        </span>
      </div>

      <!-- Tipo de atención -->
      <div class="mt-1 text-sm text-slate-700 flex flex-wrap gap-x-6 gap-y-1">
        <span class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-3-3v6m-9 3h18" />
          </svg>
          <span><b>Tipo de consulta:</b> {{ atencion.tipoConsulta }}</span>
        </span>
        <span class="inline-flex items-center gap-1.5">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0 1 21 8.618V15.5a2.5 2.5 0 0 1-2.5 2.5H15m0-8.5V17a2 2 0 0 1-2 2H5.5A2.5 2.5 0 0 1 3 16.5v-9A2.5 2.5 0 0 1 5.5 5H13a2 2 0 0 1 2 2v0z" />
          </svg>
          <span><b>Modalidad:</b> {{ atencion.tipoAtencion }}</span>
        </span>
      </div>

      <!-- Motivo y diagnósticos -->
      <div class="mt-2 text-base text-slate-800">
        <div class="inline-flex items-center gap-1.5 mb-0.5 text-slate-900">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 8h10M7 12h6m-6 4h4m5-13H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h9l5-5V5a2 2 0 0 0-2-2z" />
          </svg>
          <span class="font-semibold">Motivo de consulta</span>
        </div>
        <span class="block text-sm leading-snug line-clamp-2" title="{{ atencion.motivoConsulta || 'No registrado' }}">
          {{ atencion.motivoConsulta || 'No registrado' }}
        </span>
      </div>
      <div class="mt-1 text-sm text-blue-900" *ngIf="atencion.diagnosticos && atencion.diagnosticos.length">
        <div class="inline-flex items-center gap-1.5 mb-0.5">
          <svg class="w-4 h-4 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6M7 7h10m-7-4h4a2 2 0 0 1 2 2v14l-4-2-4 2V5a2 2 0 0 1 2-2z" />
          </svg>
          <span class="font-semibold">Diagnósticos CIE-10</span>
        </div>
        <span *ngFor="let diag of atencion.diagnosticos; let last = last">
          {{ diag.codigo }} - {{ diag.nombre }}<span *ngIf="!last">, </span>
        </span>
      </div>
    </div>
    <div class="flex flex-col gap-2 items-end min-w-[190px] ml-4 bg-slate-50/80 border border-slate-100 rounded-2xl px-3 py-3 shadow-sm">
      <button
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl bg-indigo-600 text-white shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:ring-offset-1 transition"
        (click)="verDetalle.emit(atencion.id)">
        Más detalles
      </button>

      <button
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl border border-sky-200 bg-sky-50 text-sky-800 hover:bg-sky-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:ring-offset-1 transition"
        (click)="verHistorial.emit(atencion.id)">
        <span class="inline-flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 2m6-2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" />
          </svg>
          <span>Historial</span>
        </span>
      </button>

      <button
        *ngIf="atencion.estado === 'PROGRAMADA' || atencion.estado === 'EN_CURSO' || atencion.estado === 'REPROGRAMADA'"
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl border border-emerald-200 bg-emerald-50 text-emerald-800 hover:bg-emerald-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-300 focus:ring-offset-1 transition"
        (click)="finalizar.emit(atencion)">
        <span class="inline-flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
          <span>Finalizar</span>
        </span>
      </button>

      <button
        *ngIf="atencion.estado === 'PROGRAMADA' || atencion.estado === 'EN_CURSO' || atencion.estado === 'REPROGRAMADA'"
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-rose-300 focus:ring-offset-1 transition"
        (click)="cancelar.emit(atencion)">
        <span class="inline-flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
          <span>Cancelar</span>
        </span>
      </button>

      <button
        *ngIf="atencion.estado === 'PROGRAMADA' || atencion.estado === 'EN_CURSO' || atencion.estado === 'REPROGRAMADA'"
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl border border-amber-200 bg-amber-50 text-amber-900 hover:bg-amber-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-300 focus:ring-offset-1 transition"
        (click)="noAsistio.emit(atencion)">
        <span class="inline-flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 5.636A9 9 0 0 0 5.636 18.364M6 6l12 12" />
          </svg>
          <span>No asistió</span>
        </span>
      </button>

      <button
        *ngIf="atencion.estado === 'PROGRAMADA' || atencion.estado === 'EN_CURSO' || atencion.estado === 'REPROGRAMADA'"
        type="button"
        class="w-full px-3 py-2 text-xs font-semibold rounded-xl border border-slate-200 bg-slate-50 text-slate-800 hover:bg-slate-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-slate-300 focus:ring-offset-1 transition"
        (click)="reprogramar.emit(atencion)">
        <span class="inline-flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582M5 19a9 9 0 1 0 3-14.197" />
          </svg>
          <span>Reprogramar</span>
        </span>
      </button>
    </div>
  </li>
</ul>
